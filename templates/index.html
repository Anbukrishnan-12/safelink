<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeLink Premium - Advanced URL Security Checker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üîí SafeLink Premium</h1>
            <p>Advanced URL Safety Checker with Company Verification</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('url')">URL Safety Check</button>
            <button class="tab-btn" onclick="showTab('company')">Company Verification</button>
        </div>

        <!-- URL Input Section -->
        <div id="url-section" class="tab-content">
            <div class="input-section">
                <div class="input-group">
                    <input 
                        type="url" 
                        id="urlInput" 
                        placeholder="Paste your URL here (e.g., https://example.com)"
                        class="url-input"
                    >
                    <button onclick="checkURL()" class="check-btn" id="checkBtn">
                        Check Safety
                    </button>
                </div>
            </div>
        </div>

        <!-- Company Input Section -->
        <div id="company-section" class="tab-content" style="display: none;">
            <div class="input-section">
                <div class="input-group">
                    <input 
                        type="text" 
                        id="companyInput" 
                        placeholder="Enter company name or URL (e.g., Google, https://securden.com)"
                        class="url-input"
                    >
                    <button onclick="verifyCompany()" class="check-btn" id="verifyBtn">
                        Verify Company
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="results-section" style="display: none;">
            <!-- URL Results -->
            <div id="url-results" class="result-card">
                <div class="status-badge" id="statusBadge">
                    <span id="statusText">SAFE</span>
                </div>
                
                <div class="result-details">
                    <h3>URL Analysis Results</h3>
                    <div class="detail-item">
                        <strong>URL:</strong> <span id="checkedUrl"></span>
                    </div>
                    <div class="detail-item">
                        <strong>Risk Level:</strong> <span id="riskLevel"></span>
                    </div>
                    <div class="detail-item">
                        <strong>Reasons:</strong>
                        <ul id="reasonsList"></ul>
                    </div>
                </div>
            </div>

            <!-- Company Results -->
            <div id="company-results" class="company-container" style="display: none;">
                <!-- Left Side - Company Info -->
                <div class="company-left">
                    <div class="status-badge" id="companyStatusBadge">
                        <span id="companyStatusText">VERIFIED</span>
                    </div>
                    
                    <div class="company-info">
                        <div class="company-avatar" id="companyAvatar">üè¢</div>
                        <h2 id="companyName">Company Name</h2>
                        <p id="companyTagline">Company description</p>
                        
                        <div class="company-stats">
                            <div class="stat-item">
                                <span class="stat-icon">üè≠</span>
                                <div>
                                    <div class="stat-label">Industry</div>
                                    <div class="stat-value" id="quickIndustry">Technology</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-icon">üìç</span>
                                <div>
                                    <div class="stat-label">Location</div>
                                    <div class="stat-value" id="quickLocation">Global</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-icon">üåê</span>
                                <div>
                                    <div class="stat-label">Website</div>
                                    <div class="stat-value" id="quickWebsite">example.com</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="companyRealityBadge" class="reality-badge" style="display: none;">
                        <span id="realityStatusText"></span>
                    </div>
                </div>
                
                <!-- Right Side - Detailed Information -->
                <div class="company-right">
                    <h3>Detailed Information</h3>
                    <div id="companyDetails"></div>
                    <div id="verificationSummary" class="verification-summary" style="display: none;">
                        <h4>Verification Summary</h4>
                        <div id="summaryDetails"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing URL security...</p>
        </div>

        <!-- Error Message -->
        <div id="error" class="error-message" style="display: none;">
            <p id="errorText"></p>
        </div>

        <!-- Security Info -->
        <div class="info-section">
            <h3>üõ°Ô∏è What We Check</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>HTTPS Encryption</strong>
                    <p>Secure connection protocol</p>
                </div>
                <div class="info-item">
                    <strong>URL Length</strong>
                    <p>Unusually long URLs can be suspicious</p>
                </div>
                <div class="info-item">
                    <strong>IP Addresses</strong>
                    <p>Direct IP usage instead of domains</p>
                </div>
                <div class="info-item">
                    <strong>Suspicious Keywords</strong>
                    <p>Common phishing terms</p>
                </div>
                <div class="info-item">
                    <strong>URL Shorteners</strong>
                    <p>Shortened links that hide destinations</p>
                </div>
                <div class="info-item">
                    <strong>Domain Structure</strong>
                    <p>Multiple subdomains analysis</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            document.getElementById('url-section').style.display = 'none';
            document.getElementById('company-section').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-section').style.display = 'block';
            event.target.classList.add('active');
            
            // Hide results
            hideElements(['results', 'error']);
        }

        async function checkURL() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            // Hide previous results and errors
            hideElements(['results', 'error']);
            
            // Validate input
            if (!url) {
                showError('Please enter a URL to check');
                return;
            }
            
            // Show loading
            showElement('loading');
            
            try {
                // Make API request
                const response = await fetch('/check-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                
                // Hide loading
                hideElement('loading');
                
                if (response.ok) {
                    displayURLResults(data);
                } else {
                    showError(data.error || 'An error occurred');
                }
                
            } catch (error) {
                hideElement('loading');
                showError('Network error. Please try again.');
            }
        }
        
        async function verifyCompany() {
            const companyInput = document.getElementById('companyInput');
            const companyName = companyInput.value.trim();
            
            // Hide previous results and errors
            hideElements(['results', 'error']);
            
            // Validate input
            if (!companyName) {
                showError('Please enter a company name to verify');
                return;
            }
            
            // Show loading
            showElement('loading');
            
            try {
                // Make API request
                const response = await fetch('/verify-company', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ company_name: companyName })
                });
                
                const data = await response.json();
                
                // Hide loading
                hideElement('loading');
                
                if (response.ok) {
                    displayCompanyResults(data);
                } else {
                    showError(data.error || 'An error occurred');
                }
                
            } catch (error) {
                hideElement('loading');
                showError('Network error. Please try again.');
            }
        }
        
        function displayURLResults(data) {
            // Hide company results, show URL results
            document.getElementById('company-results').style.display = 'none';
            document.getElementById('url-results').style.display = 'block';
            
            // Update status badge
            const statusBadge = document.getElementById('statusBadge');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = data.status;
            statusBadge.className = `status-badge ${data.status.toLowerCase()}`;
            
            // Update details
            document.getElementById('checkedUrl').textContent = data.url;
            document.getElementById('riskLevel').textContent = data.risk_level;
            
            // Update reasons list
            const reasonsList = document.getElementById('reasonsList');
            reasonsList.innerHTML = '';
            
            data.reasons.forEach(reason => {
                const li = document.createElement('li');
                li.textContent = reason;
                reasonsList.appendChild(li);
            });
            
            // Show results
            showElement('results');
        }
        
        function displayCompanyResults(data) {
            // Hide URL results, show company results
            document.getElementById('url-results').style.display = 'none';
            document.getElementById('company-results').style.display = 'block';
            
            // Update main status badge
            const statusBadge = document.getElementById('companyStatusBadge');
            const statusText = document.getElementById('companyStatusText');
            
            // Update reality badge (REAL/FAKE)
            const realityBadge = document.getElementById('companyRealityBadge');
            const realityStatusText = document.getElementById('realityStatusText');
            
            if (data.verified && data.is_real) {
                statusText.textContent = 'VERIFIED';
                statusBadge.className = 'status-badge safe';

                realityStatusText.textContent = 'REAL COMPANY';
                realityBadge.className = 'reality-badge real';
                realityBadge.style.display = 'block';
                
                // Update left side company info
                document.getElementById('companyName').textContent = data.company_name || 'Unknown Company';
                document.getElementById('companyTagline').textContent = data.description || 'Leading company in technology sector';
                document.getElementById('quickIndustry').textContent = data.industry || 'Technology';
                document.getElementById('quickLocation').textContent = data.location || 'Global';
                document.getElementById('quickWebsite').textContent = data.domain || data.url || 'Not specified';
                
                // Set company avatar based on industry
                const avatar = document.getElementById('companyAvatar');
                if (data.industry) {
                    const industryIcons = {
                        'Technology': 'üíª',
                        'Cybersecurity': 'üîê',
                        'Finance': 'üí∞',
                        'Healthcare': 'üè•',
                        'E-commerce': 'üõí',
                        'Software': '‚öôÔ∏è',
                        'Automotive': 'üöó',
                        'Social Media': 'üì±'
                    };
                    avatar.textContent = industryIcons[data.industry] || 'üè¢';
                }
            } else {
                statusText.textContent = 'NOT VERIFIED';
                statusBadge.className = 'status-badge fraud';
                
                realityStatusText.textContent = 'FAKE/UNKNOWN';
                realityBadge.className = 'reality-badge fake';
                realityBadge.style.display = 'block';
                
                // Update left side for fake companies
                document.getElementById('companyName').textContent = data.company_name || 'Unknown Company';
                document.getElementById('companyTagline').textContent = 'Company could not be verified';
                document.getElementById('quickIndustry').textContent = 'Unknown';
                document.getElementById('quickLocation').textContent = 'Unknown';
                document.getElementById('quickWebsite').textContent = 'Unknown';
                document.getElementById('companyAvatar').textContent = '‚ùå';
            }
            
            // Update company details
            const detailsDiv = document.getElementById('companyDetails');
            detailsDiv.innerHTML = '';
            
            if (data.verified && data.is_real) {
                const details = [
                    { label: 'Company Name', value: data.company_name },
                    { label: 'Industry', value: data.industry || 'Technology' },
                    { label: 'Location', value: data.location || 'Global' },
                    { label: 'Description', value: data.description || 'Leading company in technology sector' },
                    { label: 'Founded Year', value: data.founded_year || '2010' },
                    { label: 'Employee Count', value: data.employee_count || '1000+' },
                    { label: 'Domain', value: data.domain || 'Not specified' },
                    { label: 'Verification Confidence', value: data.confidence || 'High' }
                ];
                
                // Add website-specific details if available
                if (data.url) {
                    details.push({ label: 'Website URL', value: data.url });
                }
                if (data.website_title) {
                    details.push({ label: 'Website Title', value: data.website_title });
                }
                if (data.about_text) {
                    details.push({ label: 'About', value: data.about_text.substring(0, 200) + (data.about_text.length > 200 ? '...' : '') });
                }
                if (data.email) {
                    details.push({ label: 'Email', value: data.email });
                }
                if (data.phone) {
                    details.push({ label: 'Phone', value: data.phone });
                }
                if (data.address) {
                    details.push({ label: 'Address', value: data.address });
                }
                if (data.website_accessible !== undefined) {
                    details.push({ label: 'Website Status', value: data.website_accessible ? 'Accessible' : 'Not Accessible' });
                }
                if (data.https_enabled !== undefined) {
                    details.push({ label: 'HTTPS Enabled', value: data.https_enabled ? 'Yes' : 'No' });
                }
                
                details.forEach(detail => {
                    const div = document.createElement('div');
                    div.className = 'detail-item';
                    div.innerHTML = `<strong>${detail.label}:</strong> ${detail.value}`;
                    detailsDiv.appendChild(div);
                });
                
                // Add social links if available
                if (data.social_links && Object.keys(data.social_links).length > 0) {
                    const socialDiv = document.createElement('div');
                    socialDiv.className = 'detail-item';
                    socialDiv.innerHTML = '<strong>Social Links:</strong>';
                    const linksList = document.createElement('ul');
                    
                    Object.entries(data.social_links).forEach(([platform, url]) => {
                        const li = document.createElement('li');
                        li.innerHTML = `<a href="${url}" target="_blank">${platform}</a>`;
                        linksList.appendChild(li);
                    });
                    
                    socialDiv.appendChild(linksList);
                    detailsDiv.appendChild(socialDiv);
                }
                
                // Show verification summary
                if (data.verification_summary || data.sources_checked) {
                    const summaryDiv = document.getElementById('verificationSummary');
                    const summaryDetails = document.getElementById('summaryDetails');
                    summaryDetails.innerHTML = '';
                    
                    if (data.verification_summary) {
                        const summaryText = document.createElement('div');
                        summaryText.className = 'detail-item';
                        summaryText.innerHTML = `<strong>Summary:</strong> ${data.verification_summary}`;
                        summaryDetails.appendChild(summaryText);
                    }
                    
                    if (data.sources && data.sources.length > 0) {
                        const sourcesText = document.createElement('div');
                        sourcesText.className = 'detail-item';
                        sourcesText.innerHTML = `<strong>Sources Checked:</strong> ${data.sources.join(', ')}`;
                        summaryDetails.appendChild(sourcesText);
                    }
                    
                    summaryDiv.style.display = 'block';
                }
                
            } else {
                // Show error/fake company information
                const errorDiv = document.createElement('div');
                errorDiv.className = 'detail-item error-detail';
                errorDiv.innerHTML = `<strong>Status:</strong> ${data.error || 'Company could not be verified'}`;
                detailsDiv.appendChild(errorDiv);
                
                if (data.company_name) {
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'detail-item';
                    nameDiv.innerHTML = `<strong>Searched For:</strong> ${data.company_name}`;
                    detailsDiv.appendChild(nameDiv);
                }
                
                // Show verification summary for failed verification
                if (data.sources_checked !== undefined) {
                    const summaryDiv = document.getElementById('verificationSummary');
                    const summaryDetails = document.getElementById('summaryDetails');
                    summaryDetails.innerHTML = '';
                    
                    const sourcesText = document.createElement('div');
                    sourcesText.className = 'detail-item';
                    sourcesText.innerHTML = `<strong>Sources Checked:</strong> ${data.sources_checked} verification sources`;
                    summaryDetails.appendChild(sourcesText);
                    
                    if (data.verification_summary) {
                        const summaryText = document.createElement('div');
                        summaryText.className = 'detail-item';
                        summaryText.innerHTML = `<strong>Summary:</strong> ${data.verification_summary}`;
                        summaryDetails.appendChild(summaryText);
                    }
                    
                    summaryDiv.style.display = 'block';
                }
            }
            
            // Show results
            showElement('results');
        }
        
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            showElement('error');
        }
        
        function showElement(id) {
            document.getElementById(id).style.display = 'block';
        }
        
        function hideElement(id) {
            document.getElementById(id).style.display = 'none';
        }
        
        function hideElements(ids) {
            ids.forEach(id => hideElement(id));
        }
        
        // Allow Enter key to trigger checks
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkURL();
            }
        });
        
        document.getElementById('companyInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyCompany();
            }
        });
    </script>
</body>
</html>